<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Code Examples · Jayben Bushnell</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;900&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
  <style>
    :root{--bg:#0b0d10; --text:#e6edf3; --muted:#99a2ad; --brand:#5eead4; --brand2:#22d3ee}
    body{background: radial-gradient(1200px 600px at 60% -10%, #0f172a 0%, rgba(15,23,42,0) 60%), var(--bg) !important;
         color:var(--text); font-family:'Outfit',system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial}
    a{color:var(--brand2)}
    .nav-dark{backdrop-filter: blur(8px); background:rgba(11,13,16,.7); border-bottom:1px solid #1f2937}
    .btn-brand{background:linear-gradient(135deg,var(--brand),var(--brand2)); color:#061118; border:none; font-weight:800}
    .card-dark{background:linear-gradient(180deg,#0c1015,#0a0d11); border:1px solid #1f2937; color:var(--text)}
    .section{padding:64px 0}
    pre{position:relative; white-space:pre-wrap}
    .copy{position:absolute; top:8px; right:8px}
    #toTopBtn{position:fixed; bottom:30px; right:30px; display:none; z-index:9999}
  </style>
</head>
<body>
  <nav class="navbar nav-dark sticky-top">
    <div class="container px-3">
      <a class="navbar-brand fw-bold text-light" href="index.html">← Back</a>
      <ul class="navbar-nav flex-row gap-3">
        <li class="nav-item"><a class="nav-link text-light" href="#EntityFactory">EntityFactory</a></li>
        <li class="nav-item"><a class="nav-link text-light" href="#ItemEntity">ItemEntity</a></li>
        <li class="nav-item"><a class="nav-link text-light" href="#OreFactory">OreFactory</a></li>
        <li class="nav-item"><a class="nav-link text-light" href="#GemFactory">GemFactory</a></li>
        <li class="nav-item"><a class="nav-link text-light" href="#Mortality">Mortality</a></li>
      </ul>
    </div>
  </nav>

  <main class="container section">
    <header class="mb-4">
      <h1 class="h3">Code Examples</h1>
      <p class="text-secondary">Here’s a small excerpt from my project Diggems. This sample highlights a data-driven factory system used for spawning and configuring ItemEntity instances. The architecture favors composition over inheritance, making it incredibly versatile and easy to extend as new item types, behaviors, and drop logic are added.</p>
    </header>

    <section id="EntityFactory" class="mb-5">
      <h2 class="h4 mb-3">EntityFactory</h2>
      <div class="card card-dark mb-3">
        <div class="card-body">
          <pre><button class="btn btn-sm btn-secondary copy" data-target="code1">Copy</button>
            <code id="code1" class="language-cs">
public class EntityFactory : MonoBehaviour
{
    [SerializeField] private GemEffectFactory gemEffectFactory;
    [SerializeField] private OreFactorySO oreFactory;
    [SerializeField] private GemFactorySO gemFactory;
    [SerializeField] private PetEggFactorySO petEggFactory;
    [SerializeField] private TreasureChestFactorySO treasureChestFactory;
    [SerializeField] private DropitemFactorySO dropitemFactory;

    public ItemEntity createOre(InventoryAsset asset, Vector3? spawnPoint) =&gt; oreFactory.create(this, asset, spawnPoint);
    public ItemEntity createGem(InventoryAsset asset, Vector3? spawnPoint) =&gt; gemFactory.create(this, asset, spawnPoint);
    public ItemEntity createPetEgg(InventoryAsset asset, Vector3? spawnPoint) =&gt; petEggFactory.create(this, asset, spawnPoint);
    public ItemEntity createTreasureChest(InventoryAsset asset, Vector3? spawnPoint) =&gt; treasureChestFactory.create(this, asset, spawnPoint);
    public ItemEntity createDropitem(InventoryAsset asset, Vector3? spawnPoint = null) =&gt; dropitemFactory.create(this, asset, spawnPoint);


    public ItemEntity createMortalEntity(InventoryAsset asset, Vector3? spawnPoint, int layer)
    {
        var itemEntity = createItemEntity(asset, spawnPoint, layer);

        var mortality = itemEntity.AddComponent&lt;Mortality&gt;();
        var damagedEffect = itemEntity.AddComponent&lt;DamagedEffect&gt;();
        mortality.setup(determineMaxHp(asset));
        mortality.getDamagedEvent().AddListener(damagedEffect.onDamaged);
        itemEntity.AddComponent&lt;DeathEffect&gt;();
        itemEntity.AddComponent&lt;ShakeEffect&gt;();
        var pickDamager = itemEntity.AddComponent&lt;PickDamager&gt;();
        var clickable = itemEntity.getGraphic().AddComponent&lt;Clickable&gt;();
        clickable.getClickUpCallback().AddListener(pickDamager.hit);
        itemEntity.AddComponent&lt;StatusEffectManager&gt;();

        return itemEntity;
    }

    public ItemEntity createItemEntity(InventoryAsset asset, Vector3? spawnPoint, int layer)
    {
        var go = new GameObject();
        go.layer = layer;
        go.name = asset.assetId;
        var itemEntity = go.AddComponent&lt;ItemEntity&gt;();
        itemEntity.setup(asset);
        if (spawnPoint.HasValue) itemEntity.transform.position = spawnPoint.Value;
        return itemEntity;
    }

    private long determineMaxHp(InventoryAsset asset)
    {
        return (long)Random.Range(asset.hpRange.x, asset.hpRange.y);
    }
}
            </code></pre>
        </div>
      </div>
    </section>

    <section id="ItemEntity" class="mb-5">
      <h2 class="h4 mb-3">ItemEntity</h2>
      <div class="card card-dark mb-3">
        <div class="card-body">
          <pre><button class="btn btn-sm btn-secondary copy" data-target="code2">Copy</button>
            <code id="code2" class="language-cs">
public class ItemEntity : MonoBehaviour, IEntityInterface
{
    public void setup(InventoryAsset asset)
    {
        this.asset = asset;
        createGraphic();
    }

    private void createGraphic()
    {
        if (asset.prefab == null) asset.prefab = AssetManager.instance.dropBag;
        graphic = Instantiate(asset.prefab, transform).transform;
        graphic.gameObject.layer = gameObject.layer;
        graphic.localPosition = Vector3.zero;
        graphic.LookAt(Camera.main.transform);
        meshCollider = graphic.GetComponent&lt;MeshCollider&gt;();
        if (meshCollider == null) meshCollider = graphic.gameObject.AddComponent&lt;MeshCollider&gt;();
    }

    public Transform getGraphic()
    {
        return graphic;
    }

    public InventoryAsset getAsset()
    {
        return asset;
    }

    private Transform graphic;
    private InventoryAsset asset;
    private MeshCollider meshCollider;
}
            </code></pre>
        </div>
      </div>
    </section>

    <section id="OreFactory" class="mb-5">
      <h2 class="h4 mb-3">OreFactory</h2>
      <div class="card card-dark mb-3">
        <div class="card-body">
          <pre><button class="btn btn-sm btn-secondary copy" data-target="code3">Copy</button>
          <code id="code3" class="language-cs">
[CreateAssetMenu(fileName = "OreFactory", menuName = "EntityFactories/OreFactory")]
public class OreFactorySO : EntityFactorySO
{
    public override ItemEntity create(EntityFactory context, InventoryAsset asset, Vector3? spawnPoint)
    {
        var itemEntity = context.createMortalEntity(asset, spawnPoint, getLayerMask());
        var deathEffect = itemEntity.GetComponent&lt;DeathEffect&gt;();
        var rubbleEffect = itemEntity.AddComponent&lt;RubbleEffect&gt;();
        deathEffect.subscribe(rubbleEffect);
        itemEntity.AddComponent&lt;CanBeRotated&gt;();
        itemEntity.AddComponent&lt;SpawnsEntitiesOnFace&gt;().setup(context);
        
        var updatesHpBar = itemEntity.AddComponent&lt;UpdatesHpBar&gt;();
        itemEntity.GetComponent&lt;IDamagable&gt;().getDamagedEvent().AddListener((damagedAmt, isCrit) =&gt; updatesHpBar.trigger());
        itemEntity.GetComponent&lt;DamagedEffect&gt;().setShake(0.01f);

        return itemEntity;
    }
}
          </code></pre>
        </div>
      </div>
    </section>

    <section id="GemFactory" class="mb-5">
      <h2 class="h4 mb-3">GemFactory</h2>
      <div class="card card-dark mb-3">
        <div class="card-body">
          <pre><button class="btn btn-sm btn-secondary copy" data-target="code4">Copy</button>
          <code id="code4" class="language-cs">
[CreateAssetMenu(fileName = "GemFactory", menuName = "EntityFactories/GemFactory")]
public class GemFactorySO : EntityFactorySO
{
    [SerializeField] private PopsOff.PopsOffParams popParams;

    public override ItemEntity create(EntityFactory context, InventoryAsset asset, Vector3? spawnPoint)
    {
        var itemEntity = context.createMortalEntity(asset, spawnPoint, getLayerMask());

        var popOffEffect = itemEntity.AddComponent&lt;PopsOff&gt;();
        popOffEffect.setup(popParams);
        var deathEffect = itemEntity.GetComponent&lt;DeathEffect&gt;();
        deathEffect.subscribe(popOffEffect);

        var givesOutRewards = itemEntity.AddComponent&lt;GivesOutRewards&gt;();
        givesOutRewards.setup(createDropData(asset));

        var triggerOnDestroy = itemEntity.AddComponent&lt;TriggerOnDestroy&gt;();
        triggerOnDestroy.subscribe(givesOutRewards);

        var rimPulse = itemEntity.getGraphic().GetComponent&lt;GemRimPulseDriver&gt;();
        var mortality = itemEntity.GetComponent&lt;Mortality&gt;();
        mortality.getDamagedEvent().AddListener((_, _) =&gt;
        {
            rimPulse.UpdateFromHP((int)mortality.getMaxHp(), (int)mortality.getCurrentHp());
        });

        return itemEntity;
    }
    
    public DropData createDropData(InventoryAsset asset)
    {
        return new DropData(1)
        {
            goldValue = asset.dropGoldValue,
            xpValue = asset.dropXpValue,
            itemId = asset.assetId
        };
    }
}
          </code></pre>
        </div>
      </div>
    </section>

    <section id="Mortality" class="mb-5">
      <h2 class="h4 mb-3">Mortality</h2>
      <div class="card card-dark mb-3">
        <div class="card-body">
          <pre><button class="btn btn-sm btn-secondary copy" data-target="code5">Copy</button>
          <code id="code5" class="language-cs">
public class Mortality : MonoBehaviour, IMortality, IDamagable
{
    public void setup(long maxHp)
    {
        this.maxHp = maxHp;
        hp = maxHp;
    }

    public void damage(long amt, bool isCrit)
    {
        if (isDead) return;

        var modifiers = GetComponents&lt;IDamageModifier&gt;().OrderBy(m =&gt; m.getPriority());
        long finalDamage = amt;
        foreach (var modifier in modifiers)
        {
            finalDamage = modifier.modifyDamage(finalDamage);
        }

        hp -= finalDamage;
        if (hp &lt;= 0) die();
        damagedEvent.Invoke(finalDamage, isCrit);
    }

    public void heal(long amt)
    {
        if (isDead) return;

        hp += amt;
        if (hp &gt; maxHp) hp = maxHp;
    }

    private void die()
    {
        deathEvent.Invoke();
        autoDestroy();
    }

    private async void autoDestroy()
    {
        await UniTask.WaitForSeconds(timeToDestroyAfterDeath);
        if (!this || !gameObject) return;
        Destroy(gameObject);
    }

    public void addStatusEffect(StatusEffect statusEffect)
    {
        statusEffects.Add(statusEffect);
    }

    public bool getIsDead() { return isDead; }
    public UnityEvent getDeathEvent() { return deathEvent; }
    public UnityEvent&lt;long, bool&gt; getDamagedEvent() { return damagedEvent; }
    public long getCurrentHp() { return hp; }
    public long getMaxHp() { return maxHp; }


    private List&lt;StatusEffect&gt; statusEffects = new List&lt;StatusEffect&gt;();
    private long hp = 1;
    private long maxHp = 1;
    private bool isDead;
    private int timeToDestroyAfterDeath = 5;
    private UnityEvent deathEvent = new UnityEvent();
    private UnityEvent&lt;long, bool&gt; damagedEvent = new UnityEvent&lt;long, bool&gt;();
}
          </code></pre>
        </div>
      </div>
    </section>

    <div class="text-end">
      <a class="btn btn-brand" href="#top">Back to top</a>
    </div>
  </main>

  <footer class="py-4 mt-4 text-center text-secondary">
    © 2025 Jayben Bushnell
  </footer>

  <button type="button" class="btn btn-brand" id="toTopBtn">↑ Top</button>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-c.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-cs.min.js"></script>
  <script>
    document.querySelectorAll('.copy').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.getAttribute('data-target');
        const el = document.getElementById(id);
        navigator.clipboard.writeText(el.textContent);
        btn.textContent = 'Copied';
        setTimeout(() => btn.textContent = 'Copy', 1200);
      });
    });
    const topBtn = document.getElementById('toTopBtn');
    window.addEventListener('scroll', () => {
      if (window.scrollY > 300) topBtn.style.display = 'block';
      else topBtn.style.display = 'none';
    });
    topBtn.addEventListener('click', () => window.scrollTo({top:0, behavior:'smooth'}));
  </script>
</body>
</html>